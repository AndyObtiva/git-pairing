#!/usr/bin/env ruby

require 'gli'
require 'git-pair'

include GLI::App

program_desc 'Keeps track of co-authors of git commits'
preserve_argv
wrap_help_text :verbatim

# config file is put into the user's home directory
PAIR_CFG_FILE = File.join(File.expand_path(ENV['HOME']),'.pairs')

pre do |global,command,options,args|
  # Pre logic here
  # Return true to proceed; false to abort and not call the chosen command
  # Use skips_pre before a command to skip this block
  # on that command only

  # Create config if it doesn't already exist
  unless File.exists?(PAIR_CFG_FILE)
    GitPairs::Pairs.init
  end

  # Load .pairs config
  if (File.exist?(PAIR_CFG_FILE))
    $pairs_conf = YAML::load(File.open(PAIR_CFG_FILE, 'r'))
  else
    exit_now! "No ~/.pairs config file found"
  end

  true
end

post do |global,command,options,args|
  # Post logic here
  # Use skips_post before a command to skip this
  # block on that command only
end

on_error do |exception|
  # Error logic here
  # return false to skip default error handling
  true
end

# put command rb files into ./../lib/commands/
commands_from './../lib/commands'

exit run(ARGV)
